name: Auto-add issues and PRs to project

on:
  issues:
    types:
      - opened
  pull_request:
    types:
      - opened

jobs:
  add-to-project:
    name: Add to project
    runs-on: ubuntu-latest
    steps:
      - name: Add to project
        uses: actions/add-to-project@v0.5.0
        with:
          # Vous devez configurer votre PROJECT_URL dans les secrets du repo
          # Format: https://github.com/users/<username>/projects/<project_number>
          # ou: https://github.com/orgs/<org>/projects/<project_number>
          project-url: ${{ secrets.PROJECT_URL }}
          github-token: ${{ secrets.GH_TOKEN }}

      - name: Add label to issue
        if: github.event_name == 'issues'
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;

            // Auto-add user-story label if title starts with "As a user"
            if (issue.title.toLowerCase().startsWith('as a user')) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['user-story']
              });
            }

            // Auto-add bonus label if title contains "(Bonus)"
            if (issue.title.includes('(Bonus)') || issue.title.includes('Bonus')) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['bonus']
              });
            }
